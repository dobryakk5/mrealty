# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è last_processed_page

## ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞**

–ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã `last_processed_page` –æ–±–Ω–æ–≤–ª—è–ª—Å—è –¥–ª—è **–ø–µ—Ä–≤–æ–≥–æ –º–µ—Ç—Ä–æ** –≤ –±–∞—Ç—á–µ, –∞ –Ω–µ –¥–ª—è **–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –º–µ—Ç—Ä–æ** –≤ –±–∞—Ç—á–µ.

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:**
- **–ë–∞—Ç—á**: `[2, 40, 38, 133, 77]`
- **–ë—ã–ª–æ**: `metro_id = metro_ids[0] = 2` (–ø–µ—Ä–≤–æ–µ –º–µ—Ç—Ä–æ)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: `update_avito_pagination(2, page)` - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–ª—è –º–µ—Ç—Ä–æ 2
- **–ü—Ä–æ–±–ª–µ–º–∞**: –õ–æ–≥–∏–∫–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—É "–ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –º–µ—Ç—Ä–æ"

## ‚úÖ **–†–µ—à–µ–Ω–∏–µ**

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `parse_multiple_metro_single_link()` - —Ç–µ–ø–µ—Ä—å `metro_id` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ **–ø–æ—Å–ª–µ–¥–Ω–µ–µ –º–µ—Ç—Ä–æ** –≤ –±–∞—Ç—á–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü.

### **–ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```python
metro_id=metro_ids[0],  # –ü–µ—Ä–≤–æ–µ –º–µ—Ç—Ä–æ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–µ
```

### **–°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```python
metro_id=metro_ids[-1],  # –ü–æ—Å–ª–µ–¥–Ω–µ–µ –º–µ—Ç—Ä–æ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü
```

## üìç **–ú–µ—Å—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

**–§–∞–π–ª**: `parse_avito_to_db.py`  
**–§—É–Ω–∫—Ü–∏—è**: `parse_multiple_metro_single_link()`  
**–°—Ç—Ä–æ–∫–∞**: ~600  
**–ö–æ–Ω—Ç–µ–∫—Å—Ç**: –ü–∞—Ä—Å–∏–Ω–≥ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Ç—Ä–æ –æ–¥–Ω–æ–π —Å—Å—ã–ª–∫–æ–π

## üéØ **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**

### **–õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü:**

1. **–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã** –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `parse_multiple_pages()`:
```python
# –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –≤ –ë–î
try:
    from parse_todb_avito import update_avito_pagination
    await update_avito_pagination(self.metro_id, page)
    print(f"üìä –û–±–Ω–æ–≤–ª–µ–Ω —Å—Ç–∞—Ç—É—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–∏: —Å—Ç—Ä–∞–Ω–∏—Ü–∞ {page} –¥–ª—è –º–µ—Ç—Ä–æ {self.metro_id}")
except Exception as e:
    print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã {page}: {e}")
```

2. **–¢–µ–ø–µ—Ä—å `self.metro_id`** = **–ø–æ—Å–ª–µ–¥–Ω–µ–µ –º–µ—Ç—Ä–æ** –≤ –±–∞—Ç—á–µ
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: `update_avito_pagination(77, page)` –¥–ª—è –±–∞—Ç—á–∞ `[2, 40, 38, 133, 77]`

### **–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:**

**–ë–∞—Ç—á**: `[2, 40, 38, 133, 77]`

**–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü:**
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1: `update_avito_pagination(77, 1)`
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2: `update_avito_pagination(77, 2)`
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 3: `update_avito_pagination(77, 3)`
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 4: `update_avito_pagination(77, 4)`
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 5: `update_avito_pagination(77, 5)`

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ë–î:**
```sql
-- system.avito_pagination_tracking
metro_id: 77
last_processed_page: 5
total_pages_processed: 5
```

## üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
‚ùå –ë–∞—Ç—á: [2, 40, 38, 133, 77]
‚ùå metro_id = metro_ids[0] = 2 (–ø–µ—Ä–≤–æ–µ –º–µ—Ç—Ä–æ)
‚ùå update_avito_pagination(2, page) - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–ª—è –º–µ—Ç—Ä–æ 2
‚ùå –õ–æ–≥–∏–∫–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—É "–ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –º–µ—Ç—Ä–æ"
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
‚úÖ –ë–∞—Ç—á: [2, 40, 38, 133, 77]
‚úÖ metro_id = metro_ids[-1] = 77 (–ø–æ—Å–ª–µ–¥–Ω–µ–µ –º–µ—Ç—Ä–æ)
‚úÖ update_avito_pagination(77, page) - –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–ª—è –º–µ—Ç—Ä–æ 77
‚úÖ –õ–æ–≥–∏–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—É "–ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –º–µ—Ç—Ä–æ"
```

## üîÑ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

- ‚úÖ **–õ–æ–≥–∏—á–Ω–æ—Å—Ç—å**: `last_processed_page` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –º–µ—Ç—Ä–æ –≤ –±–∞—Ç—á–µ
- ‚úÖ **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: –õ–æ–≥–∏–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç `update_parsing_progress`
- ‚úÖ **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å**: –ü—Ä–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –º–µ—Ç—Ä–æ
- ‚úÖ **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å**: –í—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –º–µ—Ç—Ä–æ

## üöÄ **–ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Ä–∞–±–æ—Ç—ã**

### 1. –ó–∞–ø—É—Å–∫ –±–∞—Ç—á–∞:
```bash
python parse_avito_to_db.py --all --batch-size 5
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ç—á–∞ `[2, 40, 38, 133, 77]`:
```
üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –±–∞—Ç—á - –≤—Å–µ –º–µ—Ç—Ä–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1: update_avito_pagination(77, 1)
üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2: update_avito_pagination(77, 2)
üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ 3: update_avito_pagination(77, 3)
üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ 4: update_avito_pagination(77, 4)
üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ 5: update_avito_pagination(77, 5)
```

### 3. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –±–∞—Ç—á–∞:
```
‚úÖ –ë–∞—Ç—á –∑–∞–≤–µ—Ä—à–µ–Ω: update_parsing_progress(session_id, 77, total_metros)
```

### 4. –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ë–î:
```sql
-- system.parsing_progress
current_metro_id: 77
processed_metros: 5

-- system.avito_pagination_tracking
metro_id: 77
last_processed_page: 5
total_pages_processed: 5
```

### 5. –ü—Ä–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:
```
üîÑ –ò—â–µ–º –º–µ—Ç—Ä–æ 78 (77 + 1)
üîÑ –î–ª—è –º–µ—Ç—Ä–æ 77: –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã 6 (5 + 1)
üÜï –î–ª—è –º–µ—Ç—Ä–æ 78: –Ω–∞—á–∏–Ω–∞–µ–º —Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã 1
```

## üìã **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏**

### –§—É–Ω–∫—Ü–∏—è `update_avito_pagination`:
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `parse_todb_avito.py`, —Å—Ç—Ä–æ–∫–∞ 355
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `metro_id: int`, `page_number: int`
- **–î–µ–π—Å—Ç–≤–∏–µ**: –û–±–Ω–æ–≤–ª—è–µ—Ç `last_processed_page` –∏ `total_pages_processed`
- **SQL**: UPSERT –≤ —Ç–∞–±–ª–∏—Ü—É `system.avito_pagination_tracking`

### –õ–æ–≥–∏–∫–∞ –≤—ã–∑–æ–≤–∞:
```python
# –í parse_multiple_pages() –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
await update_avito_pagination(self.metro_id, page)

# –¢–µ–ø–µ—Ä—å self.metro_id = –ø–æ—Å–ª–µ–¥–Ω–µ–µ –º–µ—Ç—Ä–æ –≤ –±–∞—Ç—á–µ
# –ù–∞–ø—Ä–∏–º–µ—Ä: update_avito_pagination(77, 5) –¥–ª—è –±–∞—Ç—á–∞ [2, 40, 38, 133, 77]
```

## üéâ **–ò—Ç–æ–≥**

–õ–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `last_processed_page` —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞:
- ‚ùå **–ë—ã–ª–æ**: –û–±–Ω–æ–≤–ª—è–ª—Å—è –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –º–µ—Ç—Ä–æ –≤ –±–∞—Ç—á–µ
- ‚úÖ **–°—Ç–∞–ª–æ**: –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –º–µ—Ç—Ä–æ –≤ –±–∞—Ç—á–µ
- üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–≥–∏—á–Ω–æ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ

–¢–µ–ø–µ—Ä—å `last_processed_page` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –º–µ—Ç—Ä–æ –≤ –±–∞—Ç—á–µ, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å –ª–æ–≥–∏–∫–æ–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞! üéØ
