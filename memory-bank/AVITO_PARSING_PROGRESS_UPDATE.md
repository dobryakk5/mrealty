# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã parsing_progress –¥–ª—è AVITO

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

–í —Å–∏—Å—Ç–µ–º—É `parsing_progress` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è AVITO (source = 1) —Å –ø–æ–ª–Ω—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ –º–µ—Ç—Ä–æ, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º CIAN.

## –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—è source

- **1** - AVITO (–ù–û–í–û–ï)
- **2** - DOMCLICK  
- **3** - YANDEX
- **4** - CIAN

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. –í `parse_todb.py`:
- –§—É–Ω–∫—Ü–∏—è `create_parsing_session()` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `source`
- –§—É–Ω–∫—Ü–∏—è `get_last_parsing_progress()` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `source`
- –í—Å–µ SQL –∑–∞–ø—Ä–æ—Å—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º `source`

### 2. –í `parse_avito_to_db.py`:
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `parsing_progress`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ `AVITO_SOURCE = 1`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `parse_metro_batch()` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≤–∫–ª—é—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ñ–ª–∞–≥–∞ `--all`

### 3. –í `parse_cian_to_db.py`:
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ `source = 4`

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –¥–ª—è AVITO

### –ö–æ–≥–¥–∞ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:
- **–¢–æ–ª—å–∫–æ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ñ–ª–∞–≥–∞ `--all`** (–ø–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö –º–µ—Ç—Ä–æ –ú–æ—Å–∫–≤—ã)
- –ü—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–µ—Ç—Ä–æ (`--metro-ids`) –∏–ª–∏ —Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏ (`--exclude`) –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:
1. –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ `--all` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏ AVITO
2. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è - –ø–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è —Å –º–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
3. –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ - —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è
4. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç—Ä–æ –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –ë–î
5. –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–µ—Å—Å–∏—è –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `completed`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Å—Å–∏–∏ –¥–ª—è AVITO:
```sql
INSERT INTO system.parsing_progress 
(property_type, time_period, current_metro_id, source, total_metros, status)
VALUES (1, NULL, first_metro_id, 1, total_metros, 'active')
```

- `property_type = 1` (–≤—Ç–æ—Ä–∏—á–∫–∞ –¥–ª—è AVITO)
- `time_period = NULL` (–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏)
- `source = 1` (AVITO)

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö –º–µ—Ç—Ä–æ —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:
```bash
python parse_avito_to_db.py --all
```

### –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–µ—Ç—Ä–æ (–±–µ–∑ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è):
```bash
python parse_avito_to_db.py --metro-ids 1,2,3
```

### –ü–∞—Ä—Å–∏–Ω–≥ —Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏ (–±–µ–∑ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è):
```bash
python parse_avito_to_db.py --exclude 4,5,6
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è AVITO

1. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ—è**: –ü—Ä–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤—Å–µ—Ö –º–µ—Ç—Ä–æ –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –º–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
2. **–ò–∑–æ–ª—è—Ü–∏—è –æ—Ç –¥—Ä—É–≥–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤**: –ü—Ä–æ–≥—Ä–µ—Å—Å AVITO –Ω–µ —Å–º–µ—à–∏–≤–∞–µ—Ç—Å—è —Å CIAN, DOMCLICK, YANDEX
3. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –ù–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö –º–µ—Ç—Ä–æ –ø—Ä–∏ —Å–±–æ–µ
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –í–∏–¥–Ω–æ, —Å–∫–æ–ª—å–∫–æ –º–µ—Ç—Ä–æ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞ —Å `--all` –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É:

```sql
SELECT 
    id, property_type, time_period, current_metro_id, 
    source, status, processed_metros, total_metros,
    time_upd
FROM system.parsing_progress 
WHERE source = 1 
ORDER BY time_upd DESC;
```

–í—Å–µ –∑–∞–ø–∏—Å–∏ AVITO –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å `source = 1` –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–∞—Ä—Å–∏–Ω–≥–∞.

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- **CIAN**: –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `source = 4` –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **AVITO**: –ù–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å `source = 1`
- **–ë—É–¥—É—â–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å DOMCLICK (2) –∏ YANDEX (3)

## –ü—Ä–∏–º–µ—Ä—ã –ª–æ–≥–æ–≤

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏:
```
üÜï –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é –ø–∞—Ä—Å–∏–Ω–≥–∞ AVITO
[PROGRESS] –°–æ–∑–¥–∞–Ω–∞ —Å–µ—Å—Å–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ ID 123 –¥–ª—è AVITO, –Ω–∞—á–∏–Ω–∞–µ–º —Å –º–µ—Ç—Ä–æ ID 1
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏:
```
üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π —Å–µ—Å—Å–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞...
üîÑ –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é 123 —Å –º–µ—Ç—Ä–æ ID 15
üîÑ –ù–∞–π–¥–µ–Ω–∞ —Å–ª–µ–¥—É—é—â–∞—è —Å—Ç–∞–Ω—Ü–∏—è: metro.id = 16, –ú–∞—è–∫–æ–≤—Å–∫–∞—è –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ 15
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:
```
üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω: 16/200 –º–µ—Ç—Ä–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
```

### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏:
```
‚úÖ –°–µ—Å—Å–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ 123 –∑–∞–≤–µ—Ä—à–µ–Ω–∞
```
