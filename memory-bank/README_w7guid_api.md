# API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ GUID

## –û–±–∑–æ—Ä

–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π endpoint –≤ `realty_parser_server.py` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ GUID –∏–∑ Baza Winner –≤ —Ñ–æ—Ä–º–∞—Ç–µ, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º —Å –¶–ò–ê–ù.

## üÜï –ù–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### 1. **–ú–æ–¥—É–ª—å `extended_data_collector.py`**
- –í—ã–Ω–µ—Å–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–∑ `flexible_collector1.py`
- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ API —Å–µ—Ä–≤–µ—Ä–µ
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç –¶–ò–ê–ù

### 2. **API Endpoint: `GET /api/property/guid/{guid}`**
- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–≤–∞—Ä—Ç–∏—Ä—ã –ø–æ GUID
- –í–æ–∑–≤—Ä–∞—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º —Å –¶–ò–ê–ù
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º API —Å–µ—Ä–≤–µ—Ä–æ–º

## üì° API Endpoint

### URL
```
GET /api/property/guid/{guid}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã
- `guid` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - GUID –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏–∑ Baza Winner

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞
```bash
curl "http://localhost:8008/api/property/guid/0D5F135E-7791-0000-0FA2-005B7F230000"
```

### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
```json
{
  "success": true,
  "data": {
    "URL": "https://www.cian.ru/sale/flat/322177282/",
    "–ö–æ–º–Ω–∞—Ç": 1,
    "–¶–µ–Ω–∞_raw": 6750000,
    "–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å": 19.1,
    "–ñ–∏–ª–∞—è –ø–ª–æ—â–∞–¥—å": null,
    "–ü–ª–æ—â–∞–¥—å –∫—É—Ö–Ω–∏": null,
    "–≠—Ç–∞–∂": 1,
    "–í—Å–µ–≥–æ —ç—Ç–∞–∂–µ–π": 5,
    "–ú–∞—Ç–µ—Ä–∏–∞–ª —Å—Ç–µ–Ω": "–º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π",
    "–ê–¥—Ä–µ—Å": "–ú–æ—Å–∫–≤–∞ –≥., –ò—Ä–∏–Ω–∏–Ω—Å–∫–∏–π 2-–π –ø–µ—Ä., 4",
    "–ú–∏–Ω—É—Ç –º–µ—Ç—Ä–æ": "11 –ë–∞—É–º–∞–Ω—Å–∫–∞—è –º.",
    "–°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è —Å–µ—Ä–∏—è": "–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç",
    "–û–ø–∏—Å–∞–Ω–∏–µ": "–ö–æ–º–Ω–∞—Ç–∞, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –∂–∏–ª–æ–µ, –æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å 19,1...",
    "–°—Ç–∞—Ç—É—Å": "–ê–∫—Ç–∏–≤–Ω–æ",
    "–ò—Å—Ç–æ—á–Ω–∏–∫": "cian.ru",
    "GUID": "0D5F135E-7791-0000-0FA2-005B7F230000",
    "Object GUID": "57A47DA7-2C4F-5A30-B03F-1166ADA0FC2B",
    "ID –æ–±—ä—è–≤–ª–µ–Ω–∏—è": 945608869,
    "External ID": "322177282",
    "–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è": "2025-06-17T14:37:46.000Z",
    "–î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏": "2025-09-27T15:01:53.495Z",
    "–¢–µ–ª–µ—Ñ–æ–Ω—ã": "79853376381"
  },
  "guid": "0D5F135E-7791-0000-0FA2-005B7F230000",
  "format": "cian_compatible",
  "message": "–î–∞–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã –ø–æ GUID",
  "timestamp": "2025-09-27 22:00:15.123456"
}
```

## üêç Python –º–æ–¥—É–ª—å

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```python
from extended_data_collector import get_property_by_guid

# –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ GUID
result = await get_property_by_guid("0D5F135E-7791-0000-0FA2-005B7F230000")

if result:
    print(f"–ö–æ–º–Ω–∞—Ç: {result['–ö–æ–º–Ω–∞—Ç']}")
    print(f"–¶–µ–Ω–∞: {result['–¶–µ–Ω–∞_raw']}")
    print(f"–ê–¥—Ä–µ—Å: {result['–ê–¥—Ä–µ—Å']}")
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
```python
# –î–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¶–ò–ê–ù
get_property_by_guid(guid: str) -> Optional[Dict[str, Any]]

# –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (–±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏)
get_extended_data_by_guid(guid: str) -> Optional[Dict[str, Any]]
```

## üîÑ –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

### –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –∏–∑ Baza Winner –≤ —Ñ–æ—Ä–º–∞—Ç –¶–ò–ê–ù

| Baza Winner API | –§–æ—Ä–º–∞—Ç –¶–ò–ê–ù | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------------|-------------|----------|
| `total_room_count` | `–ö–æ–º–Ω–∞—Ç` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç |
| `price` | `–¶–µ–Ω–∞_raw` | –¶–µ–Ω–∞ –≤ —Ä—É–±–ª—è—Ö |
| `total_square` | `–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å` | –û–±—â–∞—è –ø–ª–æ—â–∞–¥—å –≤ –º¬≤ |
| `life_square` | `–ñ–∏–ª–∞—è –ø–ª–æ—â–∞–¥—å` | –ñ–∏–ª–∞—è –ø–ª–æ—â–∞–¥—å –≤ –º¬≤ |
| `kitchen_square` | `–ü–ª–æ—â–∞–¥—å –∫—É—Ö–Ω–∏` | –ü–ª–æ—â–∞–¥—å –∫—É—Ö–Ω–∏ –≤ –º¬≤ |
| `storey` / `storeys_count` | `–≠—Ç–∞–∂` / `–í—Å–µ–≥–æ —ç—Ç–∞–∂–µ–π` | –≠—Ç–∞–∂ –∏ –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ |
| `walls_material_type_name` | `–ú–∞—Ç–µ—Ä–∏–∞–ª —Å—Ç–µ–Ω` | –ú–∞—Ç–µ—Ä–∏–∞–ª —Å—Ç–µ–Ω |
| `address` | `–ê–¥—Ä–µ—Å` | –ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å |
| `geo_cache_subway_station_name_1` + `walking_access_1` | `–ú–∏–Ω—É—Ç –º–µ—Ç—Ä–æ` | "11 –ë–∞—É–º–∞–Ω—Å–∫–∞—è –º." |
| `note` | `–û–ø–∏—Å–∞–Ω–∏–µ` | –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ |
| `external_url` | `URL` | –°—Å—ã–ª–∫–∞ –Ω–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ |

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏**: –º–µ–±–µ–ª—å, —Ç–µ—Ö–Ω–∏–∫–∞, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- **–°–∏—Å—Ç–µ–º–Ω—ã–µ –ø–æ–ª—è**: GUID, Object GUID, ID –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏**: –¥–∞—Ç—ã —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
- **–ö–æ–Ω—Ç–∞–∫—Ç—ã**: —Ç–µ–ª–µ—Ñ–æ–Ω—ã, –ø—Ä–æ–¥–∞–≤–µ—Ü

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check
```bash
curl "http://localhost:8008/api/health"
```

–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:
```json
{
  "status": "healthy",
  "service": "realty-parser-api",
  "extended_collector_available": true,
  ...
}
```

### –°–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
```bash
curl "http://localhost:8008/api/sources"
```

–¢–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç Baza Winner:
```json
{
  "sources": [
    ...,
    {
      "name": "Baza Winner (GUID)",
      "domain": "baza-winner.ru",
      "available": true,
      "source_id": "baza_winner_guid"
    }
  ]
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
python3 test_guid_endpoint.py
```

–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
1. ‚úÖ –ú–æ–¥—É–ª—å `extended_data_collector.py`
2. ‚úÖ API endpoint `/api/property/guid/{guid}`
3. ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ GUID

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
python3 realty_parser_server.py
```

–°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8008`

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –° —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º workflow

1. **–ú–∞—Å—Å–æ–≤—ã–π —Å–±–æ—Ä**: `flexible_collector.py` —Å–æ–±–∏—Ä–∞–µ—Ç GUID –≤ –ë–î
2. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –∏ –æ—Ç–±–æ—Ä –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã—Ö GUID
3. **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è**: –ù–æ–≤—ã–π API –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ GUID
4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –î–∞–Ω–Ω—ã–µ –≤ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º —Å –¶–ò–ê–ù —Ñ–æ—Ä–º–∞—Ç–µ

### –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
```python
# 1. –ü–æ–ª—É—á–∞–µ–º GUID –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
guid_list = get_guids_from_database()

# 2. –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
for guid in guid_list:
    property_data = await get_property_by_guid(guid)
    if property_data:
        process_property_data(property_data)
```

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–°–∫–æ—Ä–æ—Å—Ç—å**: ~2-5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–ø—Ä–æ—Å
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç (–¥–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ)
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: API rate limits Baza Winner
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**: –ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏

## üõ†Ô∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –¢–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞
–í `extended_data_collector.py`:
```python
ACCESS_TOKEN = "your_access_token"
USER_ID = "your_user_id"
ORDER_ID = "your_order_id"
WSCG = "your_wscg"
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **404**: GUID –Ω–µ –Ω–∞–π–¥–µ–Ω
- **503**: –°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- **500**: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ API

## üìà –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö GUID
2. **Batch API**: –ü–æ–ª—É—á–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö GUID –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
3. **Webhooks**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã**: JSON —Å—Ö–µ–º—ã –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

---

**üéâ –ù–æ–≤—ã–π GUID API –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

–ü–æ–ª—É—á–∞–π—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–≤–∞—Ä—Ç–∏—Ä –∏–∑ Baza Winner –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –¶–ò–ê–ù —á–µ—Ä–µ–∑ HTTP API –∏–ª–∏ Python –º–æ–¥—É–ª—å.