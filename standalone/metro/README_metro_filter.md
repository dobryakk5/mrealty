# Фильтр по метро для парсера CIAN

## Описание

Добавлен новый фильтр по станциям метро в парсер объявлений CIAN. Теперь можно искать недвижимость:
1. По типу жилья (вторичка/новостройки)
2. По времени публикации (час/день/неделя/сегодня)
3. **По станции метро** (новый!)
4. **По времени в пути до метро** (новый!)

## Настройка

В файле `parse_cian_to_db.py` настройте параметры:

```python
# Новые настройки для фильтра по метро
METRO_ID = 68  # ID станции метро из ЦИАН (например: 68 для "Маяковская")
FOOT_MIN = 20  # Время в пути до метро в минутах (например: 20)
```

## Как найти ID станции метро

1. Запустите скрипт сопоставления метро: `python metro_mapping.py`
2. Откройте файл `metro_mapping_results.csv`
3. Найдите нужную станцию и скопируйте её `cian_id`

Пример:
```csv
line_id,name,cian_id,mapping_status
2,Маяковская,68,Сопоставлено
```

## Примеры использования

### Поиск новостроек у метро "Маяковская" (ID=68) в радиусе 20 минут пешком

```python
METRO_ID = 68    # Маяковская
FOOT_MIN = 20    # До 20 минут пешком
PROPERTY_TYPE = 2 # Новостройки
```

### Поиск вторички у метро "Перово" (ID=90) в радиусе 30 минут пешком

```python
METRO_ID = 90    # Перово
FOOT_MIN = 30    # До 30 минут пешком
PROPERTY_TYPE = 1 # Вторичка
```

## Генерируемые URL

Скрипт автоматически формирует правильные URL для поиска:

- **Без метро**: `https://www.cian.ru/cat.php?deal_type=sale&engine_version=2&offer_type=flat&region=1&object_type%5B0%5D=2&totime=3600`
- **С метро**: `https://www.cian.ru/cat.php?deal_type=sale&engine_version=2&offer_type=flat&region=1&object_type%5B0%5D=2&totime=3600&metro%5B0%5D=68`
- **С метро + временем**: `https://www.cian.ru/cat.php?deal_type=sale&engine_version=2&foot_min=20&metro%5B0%5D=68&offer_type=flat&only_foot=2`

## Запуск

```bash
python parse_cian_to_db.py
```

Скрипт покажет:
- URL поиска с применёнными фильтрами
- Информацию о выбранных фильтрах
- Статистику найденных объявлений
