# –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –±–∞—Ç—á–∞–º–∏

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
**–ü—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –±–∞—Ç—á–∞–º–∏ –ª–æ–≥–∏–∫–∞ –ù–ï —É—á–∏—Ç—ã–≤–∞–ª–∞ –º–µ—Å—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑** - –±–∞—Ç—á–∏ –≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–ª–∏ —Å –Ω–∞—á–∞–ª–∞, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –ø–∞—Ä—Å–∏–Ω–≥—É —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –º–µ—Ç—Ä–æ.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–∞ **–ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –±–∞—Ç—á–∞–º–∏** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–∏—Å—Ç–µ–º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ `system.parsing_progress`.

## üîß –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ

### 1. –í–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –±–∞—Ç—á–µ–π
```python
# –ë–´–õ–û: –¢–æ–ª—å–∫–æ –¥–ª—è --all
use_progress_tracking = args.all

# –°–¢–ê–õ–û: –î–ª—è --all –ò –¥–ª—è –±–∞—Ç—á–µ–π
use_progress_tracking = args.all or args.batch_size > 0
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–∞—Ç—á–µ–π
```python
if use_progress_tracking:
    print(f"üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–∞—Ç—á–µ–π...")
    progress = await get_last_parsing_progress(1, None, AVITO_SOURCE)
    
    if progress and progress['status'] == 'active':
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —Å –∫–∞–∫–æ–π –ø–∞—á–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
        current_batch_index = await batch_parser.get_resume_batch_index(
            metro_batches, progress, args.start_page
        )
```

### 3. –§—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```python
async def get_resume_batch_index(self, metro_batches, progress, start_page):
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —Å –∫–∞–∫–æ–π –ø–∞—á–∫–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥"""
    # –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–∞—á–∫–∏ —Å —Ç–µ–∫—É—â–∏–º –º–µ—Ç—Ä–æ
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è
    # –í–æ–∑–≤—Ä–∞—Ç –∏–Ω–¥–µ–∫—Å–∞ –ø–∞—á–∫–∏ –¥–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—á–∫–∏
```python
# –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç—Ä–æ –≤ –ø–∞—á–∫–µ
if use_progress_tracking and session_id:
    for metro in metro_batch:
        total_metros_processed += 1
        await update_parsing_progress(session_id, metro['id'], total_metros_processed)
```

## üìä –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
```
üÜï –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è –±–∞—Ç—á–µ–π: ID=123
üì¶ –°–æ–∑–¥–∞–Ω–æ 80 –ø–∞—á–µ–∫ –º–µ—Ç—Ä–æ –ø–æ 5 –º–µ—Ç—Ä–æ –≤ –∫–∞–∂–¥–æ–π
üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø–∞—Ä—Å–∏–Ω–≥ 80 –ø–∞—á–µ–∫ –º–µ—Ç—Ä–æ
üìç –ü–∞—á–∫–∞ 1/80: 5 –º–µ—Ç—Ä–æ
   ‚Ä¢ üÜï –ù–û–í–ê–Ø –ü–ê–ß–ö–ê: –Ω–∞—á–∏–Ω–∞–µ–º —Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã 1
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è
```
üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–∞—Ç—á–µ–π...
üîç –ù–∞–π–¥–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è –±–∞—Ç—á–µ–π: ID=123
   ‚Ä¢ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –º–µ—Ç—Ä–æ: 45
   ‚Ä¢ –¢–µ–∫—É—â–µ–µ –º–µ—Ç—Ä–æ ID: 46
   ‚Ä¢ –í—Å–µ–≥–æ –º–µ—Ç—Ä–æ –≤ —Å–µ—Å—Å–∏–∏: 400
üîÑ –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –ø–∞—á–∫–∏ 10/80
üìç –ü–∞—á–∫–∞ 10/80: 5 –º–µ—Ç—Ä–æ
   ‚Ä¢ üÜï –ù–û–í–ê–Ø –ü–ê–ß–ö–ê: –Ω–∞—á–∏–Ω–∞–µ–º —Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã 1
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
```
python parse_avito_to_db.py --all --batch-size 5 --start-page 3
üîÑ –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –ø–∞—á–∫–∏ 10/80
üìç –ü–∞—á–∫–∞ 10/80: 5 –º–µ—Ç—Ä–æ
   ‚Ä¢ üîÑ –ü–†–û–î–û–õ–ñ–ï–ù–ò–ï: –Ω–∞—á–∏–Ω–∞–µ–º —Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã 3
```

## üîç –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –º–µ—Å—Ç–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –ø–∞—á–∫–∏
1. **–ù–∞—Ö–æ–¥–∏–º —Ç–µ–∫—É—â–µ–µ –º–µ—Ç—Ä–æ** –ø–æ `progress['current_metro_id']`
2. **–û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–∞—á–∫—É** —Å —ç—Ç–∏–º –º–µ—Ç—Ä–æ
3. **–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è** (avito_id, is_msk)
4. **–í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–Ω–¥–µ–∫—Å –ø–∞—á–∫–∏** –¥–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases
- **–ú–µ—Ç—Ä–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ**: –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é
- **–ú–µ—Ç—Ä–æ –Ω–µ–ª—å–∑—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å**: –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π –ø–∞—á–∫–µ
- **–í—Å–µ –º–µ—Ç—Ä–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã**: –ó–∞–≤–µ—Ä—à–∞–µ–º —Å–µ—Å—Å–∏—é

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏
- **–ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞** —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –º–µ—Ç—Ä–æ
- **–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å –º–µ—Å—Ç–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏** –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** –ø–æ—Å–ª–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π

### –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞** –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—á–∫–∏
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** –≤ –ë–î
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏** –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ

### –ì–∏–±–∫–æ—Å—Ç—å
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å --start-page** –¥–ª—è –ø–µ—Ä–≤–æ–π –ø–∞—á–∫–∏
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** (--max-days, --max-pages)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞** —Å –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ
- ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –õ–æ–≥–∏–∫–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –±–∞—Ç—á–µ–π
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –±–∞—Ç—á–µ–π
- –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è
- –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases

## üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

### ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ
- –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ
- –ü–∞—Ä–∞–º–µ—Ç—Ä `--start-page` —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø–µ—Ä–≤–æ–π –ø–∞—á–∫–∏
- –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∞
- API –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω–æ

### üîß –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞—Ç—á–µ–π
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—á–∫–∏
- –£–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **–†–∞–∑–º–µ—Ä –ø–∞—á–∫–∏**: 5-10 –º–µ—Ç—Ä–æ (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–µ—Ä—ã–≤–∞–π—Ç–µ –∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–π—Ç–µ

### –î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ ID —Å–µ—Å—Å–∏–π –≤ –ª–æ–≥–∞—Ö
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ –ø–∞—á–∫–∞–º
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–∞—á–µ–∫

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ  
**–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** ‚úÖ 100%  
**–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:** ‚úÖ –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è  
**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –ø–∞—Ä—Å–∏–Ω–≥–µ
