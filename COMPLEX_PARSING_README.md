# Парсинг названий комплексов (ЖК) в parse_avito_1metro.py

## Что добавлено

В файл `parse_avito_1metro.py` добавлена функция `extract_complex_name()` для извлечения названий жилых комплексов из HTML-карточек Avito.

## Как работает

Функция использует **структурный подход** для поиска названий комплексов, так как на Avito названия комплексов часто указываются без явных указателей типа "ЖК".

### Основной метод: структурный поиск
**Название комплекса обычно находится в определенном месте на странице:**
- **После тегов** (собственник, агентство, документы проверены, лифт, парковка и т.д.)
- **Перед адресом** (улица, дом, метро)

**Алгоритм:**
1. Анализирует весь текст карточки по строкам
2. Находит последний тег (конец блока тегов)
3. Находит начало адреса (строка с улицей/метро)
4. Ищет название комплекса **между** этими позициями
5. Исключает строки, которые явно не являются названиями (м², эт, квартира, студия и т.д.)

### Альтернативный метод: анализ характеристик
Если структурный поиск не дал результата, анализирует характеристики:
- Ищет строки без ключевых слов тегов
- Проверяет, что строка содержит только буквы, цифры, пробелы и дефисы
- Исключает строки с явными тегами

### Поиск в описании
Анализирует описание карточки по той же логике, что и характеристики.

## Интеграция

Функция интегрирована в основной процесс парсинга карточки:
- Вызывается после парсинга характеристик
- Результат сохраняется в `card_data['complex_name']`
- Используется в `prepare_data_for_db()` для сохранения в БД

## Примеры работы

```
✅ Название комплекса найдено между тегами и адресом: Солнечный
✅ Название комплекса найдено в характеристиках: Центральный
✅ Название комплекса найдено в описании: Морской
⚠️ Название комплекса не найдено
```

## Структура страницы Avito

```
Заголовок: 2-к квартира, 65 м², 5/9 эт.
Собственник                    ← Теги (начало)
Документы проверены            ← Теги
Лифт                          ← Теги
Парковка                      ← Теги (конец)
Солнечный                     ← НАЗВАНИЕ КОМПЛЕКСА (здесь!)
ул. Ленина, 15               ← Адрес (начало)
м. Площадь Революции, 5 мин. ← Адрес
```

## Очистка названий

Функция автоматически исключает строки, содержащие:
- **Теги**: собственник, агентство, документы, проверены, реквизиты, лифт, парковка, балкон, кондиционер
- **Технические данные**: м², эт, квартира, студия
- **Адресные данные**: метро, мин

## Преимущества подхода

1. **Не зависит от ключевых слов** - работает даже если нет "ЖК", "жилой комплекс" и т.д.
2. **Использует структуру страницы** - ищет в правильном месте
3. **Умная фильтрация** - исключает неподходящие строки
4. **Надежность** - работает с различными вариантами оформления

## Тестирование

Функция протестирована на различных вариантах:
- Название комплекса между тегами и адресом
- Название комплекса в характеристиках
- Название комплекса с дефисами
- Случаи без указания комплекса
- Различные позиции названия комплекса

Все тесты проходят успешно.
